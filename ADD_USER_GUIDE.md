// 新增用戶功能測試指南

## 🚀 新增用戶功能已實現

### ✨ 功能特色

1. **權限控制**：只有擁有 `CREATE_USERS` 權限的用戶才能看到新增按鈕
2. **表單驗證**：
   - 電子郵件必填且格式正確
   - 必須以 `@bright-edu.com` 結尾
   - 檢查重複郵件
3. **角色選擇**：預設為檢視者，可選擇其他角色
4. **權限預覽**：即時顯示選擇角色的權限數量
5. **即時反饋**：新增成功後顯示成功訊息

### 🔧 使用步驟

1. **檢查權限**：確保您的帳號擁有管理員或超級管理員權限
2. **點擊新增**：在用戶管理頁面點擊「新增用戶」按鈕
3. **填寫資訊**：
   - 輸入有效的 @bright-edu.com 電子郵件
   - 選擇適當的角色
4. **確認新增**：點擊「新增」按鈕完成

### 📋 表單驗證規則

```javascript
// 電子郵件驗證
rules: [
  { required: true, message: "請輸入電子郵件" },
  { type: "email", message: "請輸入有效的電子郵件格式" },
  {
    pattern: /@bright-edu\.com$/,
    message: "電子郵件必須以 @bright-edu.com 結尾",
  },
];

// 重複檢查
const emailExists = users.some((user) => user.email === values.email);
if (emailExists) {
  message.error("此電子郵件已存在");
  return;
}
```

### 🎯 測試用例

#### 有效的測試郵件（根據環境）

**開發環境：**

- `new-dev@bright-edu.com`
- `test-user@bright-edu.com`
- `dev-tester@bright-edu.com`

**正式環境：**

- `new-admin@bright-edu.com`
- `staff@bright-edu.com`
- `support@bright-edu.com`

#### 無效的測試郵件

- `user@gmail.com` (❌ 域名不符)
- `user@bright-edu` (❌ 格式不完整)
- 已存在的郵件 (❌ 重複)

### 🔒 權限矩陣

| 角色       | 可見新增按鈕 | 可設定角色     |
| ---------- | ------------ | -------------- |
| 超級管理員 | ✅           | 所有角色       |
| 管理員     | ✅           | 除超級管理員外 |
| 編輯者     | ❌           | -              |
| 檢視者     | ❌           | -              |

### 🚨 注意事項

1. **環境分離**：新增的用戶會自動歸類到當前環境
2. **角色限制**：非超級管理員無法創建超級管理員帳號
3. **即時儲存**：新增後會自動儲存到對應環境的 localStorage
4. **預設設定**：新用戶狀態為 "active"，最後登入時間為創建時間

### 🐛 疑難排解

**問題：新增按鈕不可見**

- 解決：檢查當前用戶是否擁有 `CREATE_USERS` 權限

**問題：郵件格式驗證失敗**

- 解決：確保郵件以 `@bright-edu.com` 結尾

**問題：提示郵件已存在**

- 解決：檢查是否在當前環境已有相同郵件的用戶

**問題：無法選擇超級管理員角色**

- 解決：只有超級管理員可以創建超級管理員帳號

---

**開發者：** GitHub Copilot  
**測試日期：** 2025 年 9 月 2 日
