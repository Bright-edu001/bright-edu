# 聯絡表單雙重備份系統使用說明

## 系統概述

本專案已實現聯絡表單的雙重備份系統，當用戶提交聯絡表單時，資料會同時儲存到：

1. **Google Sheets** - 原有的儲存方式
2. **Firebase Firestore** - 新增的備份方式

## 功能特色

### ✅ 雙重保障

- 即使其中一個系統失效，另一個仍可正常運作
- 提高資料安全性和可靠性

### ✅ 即時監控

- 管理介面可即時查看新提交的表單
- 自動更新，無需手動重新整理

### ✅ 狀態管理

- 支援表單處理狀態追蹤（待處理/處理中/已完成）
- 可新增備註記錄處理過程

### ✅ 資料匯出

- 支援 CSV 格式匯出
- 方便進行資料分析或備份

## 使用方式

### 前端表單提交

使用者在網站上填寫聯絡表單後，系統會：

1. 驗證表單資料
2. 同時提交到 Google Sheets 和 Firestore
3. 顯示提交結果給使用者

### 管理介面操作

#### 1. 查看聯絡表單

- 登入管理後台：`/admin`
- 點擊左側選單的「聯絡表單」
- 即時查看所有提交的表單資料

#### 2. 更新處理狀態

- 點擊表格中的編輯按鈕（鉛筆圖示）
- 選擇處理狀態：
  - 🟠 **待處理** - 新提交的表單
  - 🔵 **處理中** - 正在處理的表單
  - 🟢 **已完成** - 已處理完成的表單
- 可新增備註記錄處理詳情

#### 3. 查看詳細資料

- 點擊表格中的查看按鈕（眼睛圖示）
- 檢視完整的表單內容和元資料

#### 4. 匯出資料

- 點擊頁面右上角的「匯出 CSV」按鈕
- 下載包含所有表單資料的 CSV 檔案

#### 5. 篩選功能

- 使用狀態下拉選單篩選不同處理狀態的表單
- 支援「全部狀態」、「待處理」、「處理中」、「已完成」

## 技術實現

### 資料結構

Firestore 中的 `contact_forms` 集合包含以下欄位：

```javascript
{
  name: "使用者姓名",
  email: "使用者信箱",
  lineId: "LINE ID（可選）",
  message: "詢問內容",
  status: "pending|processing|completed",
  source: "website_contact_form",
  createdAt: "建立時間戳",
  updatedAt: "更新時間戳",
  notes: "管理員備註（可選）",
  metadata: {
    userAgent: "使用者瀏覽器資訊",
    referrer: "來源頁面",
    url: "提交頁面網址"
  }
}
```

### 安全性

- Firestore 使用安全規則保護資料
- 前端只能新增資料，無法讀取其他使用者的資料
- 管理功能需要登入驗證

## 錯誤處理

### 部分儲存失敗

如果只有一個系統成功儲存，使用者仍會看到成功訊息，但會在後台記錄錯誤資訊供查看。

### 完全儲存失敗

如果兩個系統都失敗，使用者會看到錯誤訊息，建議使用其他聯絡方式。

## 維護說明

### 定期檢查

1. 定期查看管理介面確認表單正常接收
2. 檢查 Google Sheets 和 Firestore 的資料一致性
3. 監控 Firebase 使用量和費用

### 備份策略

1. Google Sheets 提供自動備份
2. Firestore 支援匯出備份
3. 建議定期下載 CSV 檔案作為本地備份

### 擴充功能

未來可以考慮加入：

- 電子郵件通知功能
- 自動回覆機制
- 更詳細的分析報表
- 批次處理功能

## 常見問題

**Q: 如果其中一個系統停止運作怎麼辦？**
A: 系統設計為容錯性高，即使一個系統失效，另一個仍可正常運作，不會影響使用者體驗。

**Q: 如何確認資料有正確儲存？**
A: 可以登入管理後台查看 Firestore 資料，同時檢查 Google Sheets 是否有對應記錄。

**Q: 可以刪除已提交的表單嗎？**
A: 在管理介面中可以刪除 Firestore 的記錄，但 Google Sheets 的資料需要手動處理。

**Q: 系統會自動回覆使用者嗎？**
A: 目前系統只負責儲存資料，需要人工回覆。未來可以考慮加入自動回覆功能。
